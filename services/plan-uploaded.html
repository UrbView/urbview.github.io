<style>
.header {
  background-color:white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 15%;
}

.header img:first-child {
  margin-left: 10;
}

.header img:last-child {
  margin-right: 0;
  width: 3%;
  margin-right: 10;
}

.result-section {
  background-color: #f2f2f2;
  padding: 50px 0;
  text-align: center;
}

.result-section h2 {
  font-size: 30px;
  margin-bottom: 20px;
}

table {
  width: 820px;
  margin-top: 100px;
  font-size: 18px;
  border-collapse: collapse;
}

td,
th {
  padding: 16px 24px;
  text-align: left;
}

thead tr {
  background-color: #45AD4B;
  color: #fff;
}

thead th {
  width: 25%;
}

tbody tr:nth-child(odd) {
  background-color: #f8f9fa;
}

tbody tr:nth-child(even) {
  background-color: #e9ecef;
}

tfoot {
    background-color: #6DC5D8;
}

</style>


<html>

    <head>

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>

         <!-- Make sure you put this AFTER Leaflet's CSS -->
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
        crossorigin=""></script>
        <link rel="stylesheet" href="/css/urbstyle.css"/>

        <style>

            .row {
            display: flex;
            }

            .column {
            flex: 25%;
            }

            @font-face {
                font-family: urbfont;
                src: url('../style/barlow/barlow/Barlow-Bold.ttf');
                }

                .h2{
                font-family: urbfont;
                }

                @font-face {
                font-family: urbfontlight;
                src: url('../style/barlow/barlow/Barlow-Light.ttf');
                }
                .p{
                    font-family: urbfontlight;
                }

        </style>

    </head>

    <body style="background-color: white; font-family: urbfont;">
    <a id = 'last-clicked-coord' style="display: none;"></a>

        <div class="header">

        <img src="../style/png/global/UI_Assets-12.png">
        <img src="../style/png/global/UI_Assets-10.png">

        </div>

        <div class="row">
            <div class="column" style="background-color: whitesmoke">

                <div id="table-container">
                    <table id="table" style="margin-left: 10%; margin-right: 10%"></table>
                </div>

                <a style="margin-left: 76.8%; margin-top: 1%">Download CSV</a>   <img src="../style/Software/City Icons/Download:Export:Share/Download Icon/V1/Download-Icon_V1_colored.svg.png" style="margin-left: 77.7%; margin-top: 1%; cursor: pointer" height=72; width=72 onclick="downloadCSV()">

            </div>

            <div class="column" style="background-color: whitesmoke">

                <div id="heatmap-container">
                  <img src="" id="heatmap-image" style="margin-left: 10%; margin-right: 10%" height=100%>
                </div>

            </div>
        </div>

        <script>

            function displayData(data) {
              // Get the response array from the data object
              const response = data.response;

              // Create a new table element
              const table = document.getElementById("table");

              // create table header
              const headerRow = table.createTHead().insertRow();
              headerRow.innerHTML = "<th>Confidence</th><th>Keywords</th><th>Label</th>";

              // Loop through each item in the response array and add a row to the table for each item
              for (let item of response) {
                // create table body
                const body = table.createTBody();
                const dataRow = body.insertRow();
                dataRow.innerHTML = `<td>${item.confidence}</td><td>${item.keywords}</td><td>${item.label}</td>`;
              }

              // Get the response array from the data object
              const aggregation = data.aggregation;

              // create table foot
              const footRow = table.createTFoot().insertRow();
              footRow.innerHTML = `<td>${aggregation.confidence}</td><td>${aggregation.keywords}</td><td>${aggregation.label}</td>`;


              // create heatmap image
              const heatmapImage = document.getElementById("heatmap-image");
              heatmapImage.src = `data:image/png;base64,${data.heatmap}`;

              // append the table and heatmap div to the container div
              const table_container = document.getElementById("table-container");
              const heatmap_container = document.getElementById("heatmap-container");
              table_container.appendChild(table);
              heatmap_container.appendChild(heatmapImage);
            }

            <!--  TODO REMOVE THIS  -->
            const urlParams = new URLSearchParams(window.location.search);
            const myData = JSON.parse(urlParams.get('data'));

            var cookies = document.cookie.split("; ");
            console.log(cookies)
            for (var i = 0; i < cookies.length; i++) {
              var cookie = cookies[i].split("=");
              if (cookie[0] === "heatmap") {
                var myVar = cookie[1];
                myData.heatmap = myVar
                console.log(myVar); // "hello"
              }
            }

            displayData(myData)

            function downloadCSV() {
              // Get the table body and rows
              const tableBody = document.getElementById("table-container");
              const rows = tableBody.querySelectorAll("tr");

              // Create a new CSV file
              let csvContent = "data:text/csv;charset=utf-8,";
              csvContent += "Confidence,Keywords,Label\n"; // Add header row

              // Loop over each row in the table and add the values to the CSV file
              for (const row of rows) {
                const cols = row.querySelectorAll("td");
                 if (cols.length === 0) {
                  // Skip row if it does not contain any td elements
                  continue;
                }
                const rowData = [
                  cols[0].textContent,
                  cols[1].textContent,
                  cols[2].textContent,
                ];
                csvContent += rowData.join(",") + "\n";
              }

              // Create a temporary link to download the file
              const encodedUri = encodeURI(csvContent);
              const link = document.createElement("a");
              link.setAttribute("href", encodedUri);
              link.setAttribute("download", "table.csv");
              document.body.appendChild(link);

              // Click the link to start the download
              link.click();

              // Clean up the temporary link element
              document.body.removeChild(link);
            }

            // Attach click event listener to the button
            const downloadBtn = document.getElementById("download-csv-btn");
            downloadBtn.addEventListener("click", downloadCSV);

        </script>

    </body>

    <footer>
        <div style="text-align: center; font-size: 14px; color: #888;">
          <p>
            Our neural network is designed to predict the risk of street harassment in different urban designs. While we've trained the model to perform data correlation and provide insights into potential safety risks, it's important to remember that the model is only as good as the data it was trained on. <br><br>
          
          <b>Additionally</b>, it's worth noting that our model is <b>not perfect</b> and should not be taken as an absolute truth. There are many complex factors that can influence safety in urban environments, and our model may not account for all of them. <br><br>
          
          As such, we encourage users to interpret the results with caution and to use them as just one source of information when making decisions about urban design.
          </p> 
        </div>
    </footer>

</html>
